#!/bin/bash

echo $@

branch=$(git rev-parse --abbrev-ref HEAD)
if [[ "${branch}" =~ ^([a-zA-Z]+-[0-9]+).* ]]
then
    prefix=$(echo ${BASH_REMATCH[1]} | awk '{print toupper($0)}')
elif [ -f "${PWD}/.git-commit-prefix" ]
then
    prefix=$(cat "${PWD}/.git-commit-prefix")
else
    # Allows us to read user input below, assigns stdin to keyboard
    exec < /dev/tty
    read -p "Specify a commit message prefix (empty for none): " prefix
    echo $prefix > "${PWD}/.git-commit-prefix"
fi

if [ $(echo $prefix | tr -d '[:space:]') ] && head -n 1 "${1}" | grep -vi "^${prefix}:"
then
    echo 3
    echo -e "${prefix}: $(cat $1)" > ${1}
fi
